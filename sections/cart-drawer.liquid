{% if template.name == 'checkout' %}
  <style>
    .payment-method-wrapper {
      margin-top: 1rem;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 15px;
      background: #fafafa;
    }
    .payment-method-wrapper h4 {
      margin-bottom: 10px;
    }
    .payment-option {
      display: flex;
      align-items: center;
      margin: 8px 0;
      gap: 8px;
    }
    .payment-option input {
      accent-color: #111;
      transform: scale(1.2);
    }
  </style>

  <div class="payment-method-wrapper">
    <h4>Choose your payment method</h4>
    <div class="payment-option">
      <input type="radio" name="payment_method" id="jazzcash" value="JazzCash">
      <label for="jazzcash">JazzCash (5% off)</label>
    </div>
    <div class="payment-option">
      <input type="radio" name="payment_method" id="easypaisa" value="EasyPaisa">
      <label for="easypaisa">EasyPaisa (5% off)</label>
    </div>
    <div class="payment-option">
      <input type="radio" name="payment_method" id="cod" value="COD" checked>
      <label for="cod">Cash on Delivery (No discount)</label>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const discount = 0.05; // 5%
      let discountApplied = false;

      const updateTotal = (applyDiscount) => {
        const subtotalElement = document.querySelector('[data-checkout-subtotal-price-target]');
        if (!subtotalElement) return;

        const subtotal = parseFloat(subtotalElement.textContent.replace(/[^\d.]/g, ''));
        let total = subtotal;

        if (applyDiscount) total = subtotal - (subtotal * discount);

        const totalElement = document.querySelector('[data-checkout-payment-due-target]');
        if (totalElement) totalElement.textContent = 'Rs. ' + total.toFixed(2);
      };

      document.querySelectorAll('input[name="payment_method"]').forEach((radio) => {
        radio.addEventListener('change', (e) => {
          const method = e.target.value;

          if (method === 'JazzCash' || method === 'EasyPaisa') {
            updateTotal(true);
            discountApplied = true;
          } else {
            updateTotal(false);
            discountApplied = false;
          }
        });
      });
    });
  </script>
{% endif %}
